%% average over sessions
monkey='danny';
sess={...
    '20180201',...
    '20180131',...
    '20180125_2',...
    '20180125_1',...
    '20180117_2',...
    '20180117_1',...
    '20171214_2',...
    '20171214_1',...
    '20171129_2',...
    '20171129_1'};

% monkey ='eddy';
% sess={...
%     '20171129',...
%     '20170518',...
%     '20170512',...
%     '20170411',...
%     '20160804',...
%     '20160803',...
%     '20160729',...
%     '20160728'};

%%
startfld=pwd;

cd ..; cd Data;cd MRI;cd avg;cd(monkey);
%cd(['pRF_sub-' monkey '_us-avg']);

medBOLD=[];
medBOLD_inv=[];
for s=1:length(sess)
    fprintf(['Loading medianBOLD_sess-' sess{s} '\n'])
    load(['medianBOLD_sess-' sess{s}])
    medBOLD = cat(5,medBOLD,medianBOLD);
    if exist('medianBOLD_inv')==1
        medBOLD_inv = cat(5,medBOLD_inv,medianBOLD_inv);
    end  
end
sessmedianBOLD = nanmedian(medBOLD,5); %#ok<*NASGU>
clear medBOLD

fprintf('Saving the median over sessions\n');
if exist('medianBOLD_inv')==1
    sessmedianBOLD_inv = nanmedian(medBOLD_inv,5); %#ok<*NASGU>
    save(['medianBOLD_sub-' monkey],...
        'sessmedianBOLD','stim',...
        'sessmedianBOLD_inv','stim_inv',...
        '-v7.3');
    clear medBOLD_inv
else
    save(['medianBOLD_sub-' monkey],...
        'sessmedianBOLD','stim',...
        '-v7.3');
end
    
%%
cd(startfld);